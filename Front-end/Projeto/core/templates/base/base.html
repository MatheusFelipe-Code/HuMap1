{% load static %}
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}HuMap{% endblock %}</title>

    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500;600;700&family=Open+Sans:wght@400;600&display=swap" rel="stylesheet">
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    
    <link rel="stylesheet" href="{% static 'core/css/common_layout.css' %}">
    
    {% block extra_css %}{% endblock %}
</head>
<body>

    <div id="notif-box" class="notif-box">
        <p>üöß Rua com buraco ‚Äî Rua Safira</p>
        <p>‚ö†Ô∏è Falta de ilumina√ß√£o ‚Äî Rua Top√°zio</p>
        <p>üö® Assalto recente ‚Äî Avenida Atl√¢ntica</p>
        <p>üî• Perigo agora ‚Äî Rua Esmeralda</p>
    </div>

    <div class="main-sidebar" id="sidebarMenu">
        <div class="list-group">
            <a href="{% url 'core:feed' %}" class="list-group-item">
                <span class="material-icons-outlined">dashboard</span> Feed
            </a>
            <a href="{% url 'users:perfil' %}" class="list-group-item"> 
                <span class="material-icons-outlined">person_outline</span> Perfil
            </a>
            <a href="{% url 'core:configuracao' %}" class="list-group-item">
                <span class="material-icons-outlined">settings</span> Configura√ß√µes
            </a>
            <a href="{% url 'core:suporte' %}" class="list-group-item">
                <span class="material-icons-outlined">help_outline</span> Suporte
            </a>
            <a href="{% url 'info:sobre' %}" class="list-group-item">
                <span class="material-icons-outlined">people_outline</span> Sobre n√≥s
            </a>
            <a href="{% url 'core:tutorial' %}" class="list-group-item">
                <span class="material-icons-outlined">menu</span> Tutorial
            </a>
        </div>
        <button id="btn-close" class="sidebar-close-btn">
            <span class="material-icons-outlined">logout</span> Sair
        </button>
    </div>

    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <nav class="main-navbar">
        <button id="menuToggleBtn"> 
            <span class="material-icons-outlined">menu</span>
        </button>

        <button class="user-profile-btn" onclick="window.location.href='{% url 'users:perfil' %}'"> 
            <img src="{% static 'core/img/perf.jpg' %}" alt="Perfil" class="profile-img"/>
            <p>Ol√°, Usu√°rio!</p>
        </button>

        <div class="search-area">
            <input type="text" id="searchInput" placeholder="Pesquisar local..." oninput="showSuggestions()"/>
            <button class="search-btn" onclick="goToSearch()">
                <img src="https://cdn-icons-png.flaticon.com/512/54/54481.png" alt="Buscar" />
            </button>
            <div id="suggestions" class="suggestions-box"></div>
        </div>

        <div class="notify-area">
            <button id="notifyBtn" class="notify-btn">
                <img src="https://cdn-icons-png.flaticon.com/512/3602/3602145.png" alt="Notifica√ß√µes"/>
            </button>
        </div>
    </nav>

    <main>
        {% block content %}
        {% endblock %}
    </main>

    <footer class="main-footer">
        <div class="footer-container">
            <div class="footer-col">
                <h1 class="footer-logo">HuMap</h1>
                <p>Conectando pessoas, ideias e solu√ß√µes.</p>
            </div>
            
            <div class="footer-col">
                <h2>Navega√ß√£o</h2>
                <ul>
                    <li><a href="{% url 'core:home' %}">In√≠cio</a></li>
                    <li><a href="{% url 'info:sobre' %}">Sobre</a></li>
                    <li><a href="{% url 'core:tutorial' %}">Tutorial</a></li>
                    <li><a href="{% url 'core:suporte' %}">Suporte</a></li>
                </ul>
            </div>
            
            <div class="footer-col">
                <h2>Contato</h2>
                <p>humap@projeto.com</p>
                <p>Recife - PE</p>
            </div>
        </div>
        
        <div class="copyright-copy">
            ¬© 2025 HuMap ‚Äî Todos os direitos reservados.
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    {% block base_js %}
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const menuToggleBtn = document.getElementById("menuToggleBtn");
            const sidebarMenu = document.getElementById("sidebarMenu");
            const sidebarOverlay = document.getElementById("sidebarOverlay");
            const btnCloseSidebar = document.getElementById("btn-close");
            const notifBox = document.getElementById("notif-box");
            const notifyBtn = document.getElementById("notifyBtn");
            const searchInput = document.getElementById("searchInput");
            const suggestionsBox = document.getElementById("suggestions");

            // --- L√≥gica do Menu ---
            window.closeMenuNotification = function() {
                if (notifBox) notifBox.classList.remove("open");
            }
            window.openMenu = function() {
                if (sidebarMenu) sidebarMenu.classList.add("active");
                if (sidebarOverlay) {
                    sidebarOverlay.style.display = "block";
                    setTimeout(() => sidebarOverlay.classList.add("active"), 10);
                }
                document.body.style.overflow = "hidden";
            }
            window.closeMenu = function() {
                if (sidebarMenu) sidebarMenu.classList.remove("active");
                if (sidebarOverlay) sidebarOverlay.classList.remove("active");
                document.body.style.overflow = "";
                setTimeout(() => {
                    if (sidebarOverlay && !sidebarMenu.classList.contains("active")) {
                        sidebarOverlay.style.display = "none";
                    }
                }, 300); 
            }

            if (menuToggleBtn) menuToggleBtn.onclick = function () {
                if (sidebarMenu.classList.contains("active")) {
                    window.closeMenu();
                } else {
                    window.closeMenuNotification();
                    window.openMenu();
                }
            };

            if (btnCloseSidebar) btnCloseSidebar.onclick = function() {
                window.closeMenu();
                setTimeout(function() {
                    window.location.href = '{% url 'core:login' %}';
                }, 100); 
            };
            
            if (sidebarOverlay) sidebarOverlay.addEventListener("click", window.closeMenu);
            
            document.querySelectorAll(".main-sidebar .list-group-item").forEach((item) => {
                item.addEventListener("click", window.closeMenu);
            });
            
            // --- L√≥gica de Notifica√ß√µes ---
            if (notifyBtn) notifyBtn.onclick = (e) => {
                e.stopPropagation();
                window.closeMenu();
                if (notifBox) notifBox.classList.toggle("open");
            };
            
            if (notifBox) notifBox.onclick = (e) => e.stopPropagation();

            // --- Fechar ao clicar fora ---
            document.body.onclick = () => {
                window.closeMenuNotification();
                if (suggestionsBox) suggestionsBox.style.display = "none";
            };

            // --- L√≥gica de Busca (Mock) ---
            window.showSuggestions = window.showSuggestions || function() {
                if (!searchInput || !suggestionsBox) return;
                const input = searchInput.value;
                if (input.length < 2) {
                    suggestionsBox.innerHTML = "";
                    suggestionsBox.style.display = "none";
                    return;
                }
                const ruas = ["Rua Safira", "Rua Top√°zio", "Rua Esmeralda", "Rua Rubi"];
                const filtrado = ruas.filter(r => r.toLowerCase().includes(input.toLowerCase()));
                suggestionsBox.innerHTML = filtrado.map(r => `<p onclick="selectStreet('${r}')">${r}</p>`).join("");
                suggestionsBox.style.display = "block";
            };

            window.selectStreet = window.selectStreet || function(nomeRua) {
                if (!searchInput || !suggestionsBox) return;
                searchInput.value = nomeRua;
                suggestionsBox.style.display = "none";
                alert("Simula√ß√£o de busca: " + nomeRua);
            };

            window.goToSearch = window.goToSearch || function() {
                const valor = document.getElementById("searchInput").value;
                if (!valor) return alert("Digite um local para pesquisar.");
                alert("Simula√ß√£o de busca: " + valor);
            };
            
            const searchArea = document.querySelector('.search-area');
            if (searchArea) searchArea.onclick = (e) => e.stopPropagation();
        });
    </script>
    {% endblock %}
    
    {% block extra_js %}{% endblock %}

</body>
</html>